# Day 5 - building workflows

Firstly, let's review the last two days.
What have we done and how do we do it again?

<!-- exercise -->

Crack open your code - can you use it again?
Can you adapt it to modify your question, feed in new data,
and modify the scientifically-important bits easily?

## Writing (re)usable code

Let's look at two chunks of code from 
[a paper](https://github.com/sashaflevy/PPiSeq) (lightly edited).
The experiment is counting barcoded lineages of yeast cells to estimate
"PPIs" (protein-protein interactions)[^zppi_note].
here's an example of one style of writing R script:

[^zppi_note]: Ask Darach if you want details, or 
[read the paper](doi.org/10.7554/eLife.62365).

```{r,example1,eval=F}
# filter out bad barcode lineages ( <= 2 time points counts > 0, or maximum of each time point <= 5 or total counts of a lineage < 10)
bad_index = rep(0, nrow(DBC_known_counts))
for(i in 1:length(bad_index)){
        counts = as.numeric(DBC_known_counts[i, 4:8])
        if (length(which(counts != 0)) < 3 | max(counts) < 5 | sum(counts) < 10){
                bad_index[i] = 1
        }
}
length(which(bad_index == 1)) # 1447775
```

<!-- exercise -->

- What is going on here?
- How do you feed in new data?
- How do you run this multiple times?
- How do you change the logic?

Here's another example from the same author:

```{r,example2,eval=F}
H202_Output <- PPI_calling_sigmoid(
    PPI_multiple=dataFrameReader_T("/Volumes/zmliu_02/PPiseq_03/H2O2/counts/PPI_multiple_p.values.csv"),
    specific_PPV=c(seq(0.5,0.58,by=0.02),seq(0.6,0.8,by=0.01),seq(0.82,0.9,by=0.02)),
    Fitness=fitness(0,1,0.01),
    p_value=seq(-4,0,0.1),
    Neg_number_PPI=6e4,
    Neg_ref_number=50, 
    p_threshold=-4
    p_loc=6, 
)
```

<!-- exercise -->

Same questions.

### Style guides can be inspiring

- [tidyverse style guide](https://style.tidyverse.org/)
- [google-specific changes](https://google.github.io/styleguide/Rguide.html)
- [Jean Fan's](https://jef.works/R-style-guide/)
- search for "R style guide"

### What style should you use?

Be inconsistently consistent!
Balance for yourself:

- How easy is it to write?
- How easy is it for you to read?
- How easy is it for others to read?
- How similar is it to what everyone else is doing (a very good thing)?

But most importantly, use what folks around you are using.
Be lazy, imitate others.

<!-- exercise -->

- How would you describe your code writing style?
- How do you name things?
- How good are your comments?
- What elements would you like to incorporate?

## Writing modular code

What is modularity of code?

Why?

think more clearly than ‚Äúhardcoding‚Äù stuff

change things more easily without forgetting everything

lets you operate at a higher level, by tweaking parameters in one place

<!-- Exercise -->

### Calculating standard error

Let's calculate the standard error of a sample of values:

```{r,stderr_fail}
values <- c(4,3,2,2,5,3,6,2,2,4)
stderr(values)
```

Er ... what? What is `stderr` doing?

`?stderr`

Write out the maths for the standard error of the mean

calcuate it

```{r,stderr_calc}
sd(values)/sqrt(length(values)-1)
```

write a function that does it

what do we save it as?

test it

### More complex modules

More examples/exercise

show a simulation of something‚Ä¶. genetic drift of a virus replicating?

lineage G1312F

exercise - wrap the entire analysis as a function

talk about ease of calling

gotcha about print() the plots

exercise - make a parameter and argument

ease of tweaking this

exercise - break into subfunctions, generate and plot

ease of changing models

## Using modules many times - loops

Doing lots of stuff - loops (Darach)

show list.files() - challenge is to analyze a bunch of ‚Ä¶.. ? protein seqs?

could evaluate the claim that four basic amino acids in a row is unusual for SARS2 (ever seen a NLS?)

Loops
How to think about a for loop

Specifically in context of processing multiple files, so list.files() ?

Students know that other control structures exist (do, while), and that they're controlled by boolean logic

Apply is a thing

Scholars will be familiar with that folks have strong opinions about using apply instead of for loops

Scholars will understand that getting the code done is the most important thing, but that good use of apply can be something to develop later to make code run faster, cleaner

Scholars will be able to read what an example of apply or s/lapply is doing, so that they can read examples online

Scholars will have heard the term "lambda function" ?

Scholars will understand that functions can be one-off (ie lambda, function(x){} ), and that's okay

## Packages are chunks of code (and sometimes data)

Let‚Äôs take a look at your code from the last few days. How would you share this with the other people in the course?

R, like other languages, is built on a package system - if you wrap up your code in particular expected ways and put it in particular expected places, it is very easy for others to get and use your code

side note link for interested students, easy of making pakcages (for advanced advanced)

### first stop - CRAN

[CRAN]()

```{r,eval=F}
library("stringdist")
```

exercise - get the stringdist library, use it

exercise - get a new viz layer, use it

### next stop - github

```{r,eval=F}
library("devtools")
```



exercise - install devtools

exercise - pull a package off github‚Ä¶.. ? maybe some sort of viz again?

problems with this

### finally - Bioconductor üò¨

[How to install Bioconductor]()

Scholars will know how to install Bioconductor package from CRAN

Scholars will know how to find and install packages from Bioconductor

explore the namespace for a package, ie ?packagename:: and TAB or ?packagename::

how to print out all the packages you have loaded


## Finding more help and documentation

Need a problem

```{r,eval=F}
?geom_line
```

```{r,eval=F}
?stringdist
```

Objective X.X: Scholars will know how to get official docs ( ? ) and how to skim/read these

Objective X.X: Scholars will see how easy it is to use a search engine to try and find other answers

Objective X.X: Scholars will understand the intention of the Slack being a learning community, or something (set expectations about this)

Source up problems from the class?

Demo a weird plot idea, search for how to do it on stack overflow?

Maybe how to change the color of facet labels in a ggplot facet graph, that's a bit tricky and demonstrates why base R is important‚Ä¶

## Reproducibility and sharing

think about this

think about the next person coming along, or yourself in 3 months

links on syllabus for more info

all sorts of automated stuff you can do



