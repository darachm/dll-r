## Working with dataframes

The most common data format we will deal with is a dataframe format. This means that data is stored in a 2D array with the rows referring to individual measurements (single patients, samples, cells, etc.) and the columns referring to parameters (genes, proteins, etc.) measured in each individual.

We work with a dataframe instead of a matrix (another datatype in R) because dataframes can tolerate different datatypes in the same table. 

```{r}
my.matrix <- matrix(data = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                    nrow = 3, ncol = 3)
my.matrix
my.matrix <- matrix(data = c(1, "apple", 3, TRUE, "cat", 6, 7, NA, FALSE),
                    nrow = 3, ncol = 3)
my.matrix
```

Tibbles will pop up as we work in *tidyverse*. Tibbles are very similar to dataframes in their ability to handle different data types across their different columns.

We will use a built-in dataset called `iris`.

```{r,eval=FALSE}
?iris
```

For the sake of this exercise, we will assign a new variable called `iris.temp` that is a shorter version of the original dataset.

```{r}
iris.temp <- head(iris, n = 10)
iris.temp
```

You can index into a dataframe and pull out one or more cells within the dataframe.

```{r}
iris.temp[1, 3]
```

Yo can pull out multiple elements at a time, specifying which row and column they reside in.

```{r}
iris.temp[c(1, 2), c(2, 3)]
```

```{r}
iris.temp[1:2, 2:3]
```

If you provide the row and not the column, or vice versa, by default R will pull out all of the available columns and rows respectively.

```{r}
iris.temp[1:2, ] # pulls out the first two rows and all columns
iris.temp[, 1:2] # pulls out the first two columns and all rows
```

It's possible to also remove elements in a dataframe using the negative sign.

```{r}
iris.temp2 <- iris.temp[-c(1, 3), ] # removes the first and third rows
head(iris.temp)
head(iris.temp2)
```

### Exploring dataframes

There are a few different functions you can use to investigate a dataframe, the size of it, and other aspects.

```{r}
dim(iris)
dim(iris.temp)
```

You can use the following functions to investigate aspects of a given dataset.

```{r}
str(iris)
colnames(iris)
summary(iris)
```

Comment on datatypes in iris???

We can try to look at the beginning of a specific column in this dataset. Dataframes that have names for their columns allow you to index into the columns specifically by name using the `$` operator as shown below.

```{r}
head(iris$Species)
```

### Building and modifying dataframes

We can also generate our own dataframes from vectors that we put together into a table.

```{r}
patient.data <- data.frame(name = c("oakley", "rashmi", "kiran"),
                           heart_rate = c(78, 68, 95),
                           disease_status = c(0, 0, 1))
patient.data
```

You can check what kind of data you are working with using the `class` and/or `typeof` functions.

```{r}
class(patient.data) # tells you that patient.data is a dataframe
```

You can add new rows and columns using the `rbind` and `cbind` functions.

```{r}
patient.data <- cbind(patient.data, gender = c("M", "F", NA))
patient.data
```

You can also remove rows and columns using the trick with a negative index.

```{r}
patient.data[, -1]
patient.data[-1, ]
```

You can merge two dataframes together using the `rbind` function assuming that their columns match up correctly.

```{r}
more.patients <- data.frame(name = c("eun", "sasha", "mattie"),
                            heart_rate = c(86, 79, 64),
                            disease_status = c(1, 1, 0),
                            gender = c(NA, "M", "F"))
more.patients
```

```{r}
all.patients <- rbind(patient.data, more.patients)
all.patients
```

------

### Handling datatypes in dataframes 

coercion and Factors

??

```{r}
all.patients$gender <- as.factor(all.patients$gender)
```

???

```{r}
all.patients <- rbind(all.patients, 
                      c(name = "lupe",
                        heart_rate = 72,
                        disease_status = 0,
                        gender = "NB"))
all.patients
```

```{r}
all.patients$gender
```

What has happened with this new addition? If you tried to add a new patient to the dataframe that had a gender that wasn't already represented in the data, chances are you had a warning and that gender was turned to `NA`.

```{r}
all.patients$gender
```

You may have seen certain parts of dataframes are factors with levels. Factors are a special data type that deals with categorical data. They can be handy for certain manipulations or visualizations, but once a factor is created, it doesn't let you easily add new categories that were not in the original set. The easiest way around this is to treat the column as characters instead of as factors.

```{r}
all.patients <- rbind(all.patients, 
                      c(name = "chihiro", 
                        heart_rate = 101, 
                        disease_status = 1, 
                        gender = "M"))
all.patients$gender
```

```{r}
all.patients$gender <- as.character(all.patients$gender)
all.patients <- rbind(all.patients, 
                      c(name = "ayodele", 
                        heart_rate = 101, 
                        disease_status = 1, 
                        gender = "NB"))
all.patients$gender
```
